import os
import shutil

storage_path = '/opt/cuckoo/storage/'
log_path = storage_path + 'logs/%s.log'
analysis_path = storage_path + 'analysis/%s/analysis.log'

dirs = [ind for ind in os.listdir('.') if ind.isdigit()]
for filt in dirs:
    if not os.path.exists(analysis_path % filt):
        shutil.rmtree('./' + filt)

    with open(analysis_path % filt) as f:
        log = f.read()

    if '+' not in log:
        shutil.rmtree('./' + filt)
    else:
        liner = log.replace('\r', '').split('\n')
        branch = filter(lambda x: '+' in x, liner)
        data = '\n'.join(branch)

        with open(log_path % filt, 'w') as branch_log:
            branch_log.write(data + '\n')
