import os
import shutil

os.mkdir('./data2')


def parser(log):
    rows = log.split('\n')

    splitted = map(lambda x: x[1:].split(','), rows[1:])
    api_filtering = filter(lambda x: len(x) == 4, splitted)

    apis = map(lambda x: x[3], api_filtering)
    filt = filter(lambda x: x != '', apis)

    return rows[0] + '\n' + '\n'.join(filt)


cnt = 0
for filename in os.listdir('data1'):
    with open('data1/' + filename) as f:
        data = f.read()

    with open('data2/' + str(cnt + 1), 'w') as f:
        dat = parser(data)

        length = len(dat.split('\n'))
        if dat != '':
            f.write(parser(data))
            cnt += 1

shutil.rmtree('data1')
